# ç¤ºä¾‹æ¡ˆé›†

## EP01

``` ts
const promise1 = new Promise((resolve, reject) => {
  console.log('promise1')
})
console.log('1', promise1);
```

è¿™æ®µä»£ç å±•ç¤ºäº† Promise çš„åŸºæœ¬ç”¨æ³•å’ŒåŒæ­¥/å¼‚æ­¥è¡Œä¸ºã€‚è®©æˆ‘ä»¬é€æ­¥è§£æï¼š

```javascript
const promise1 = new Promise((resolve, reject) => {
  console.log('promise1')
})
console.log('1', promise1);
```

### ä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼š

1. **åˆ›å»º Promise å¯¹è±¡**ï¼š
   - å½“ `new Promise` æ‰§è¡Œæ—¶ï¼Œä¼ å…¥çš„ executor å‡½æ•°ï¼ˆ`(resolve, reject) => {...}`ï¼‰ä¼š**ç«‹å³åŒæ­¥æ‰§è¡Œ**
   - æ‰€ä»¥ä¼šå…ˆè¾“å‡º `'promise1'`

2. **console.log è¾“å‡º**ï¼š
   - ç„¶åæ‰§è¡Œ `console.log('1', promise1)`
   - æ­¤æ—¶ `promise1` æ˜¯ä¸€ä¸ª pending çŠ¶æ€çš„ Promise å¯¹è±¡

### è¾“å‡ºç»“æœï¼š
```
promise1
1 Promise {<pending>}
```

### å…³é”®ç‚¹è¯´æ˜ï¼š
- Promise çš„ executor å‡½æ•°æ˜¯**åŒæ­¥æ‰§è¡Œ**çš„
- åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œexecutor å‡½æ•°å†…éƒ¨æ²¡æœ‰è°ƒç”¨ `resolve` æˆ– `reject`ï¼Œæ‰€ä»¥ Promise ä¼šä¿æŒ `pending` çŠ¶æ€
- ç¬¬äºŒä¸ª `console.log` è¾“å‡ºæ—¶ï¼Œæ˜¾ç¤º Promise çš„çŠ¶æ€æ˜¯ `<pending>`

### è¡¥å……è¯´æ˜ï¼š
å¦‚æœæƒ³è®© Promise çŠ¶æ€æ”¹å˜ï¼Œéœ€è¦è°ƒç”¨ resolve æˆ– rejectï¼š
```javascript
const promise2 = new Promise((resolve, reject) => {
  console.log('promise2');
  resolve();
})
console.log('2', promise2); 
// è¾“å‡ºï¼š
// promise2
// 2 Promise {<fulfilled>}
```

è¿™ç§ç«‹å³æ‰§è¡Œçš„ Promise æœ‰æ—¶è¢«ç§°ä¸º"çƒ­"Promiseï¼Œå› ä¸ºå®ƒå¼€å§‹æ‰§è¡Œä¸éœ€è¦é¢å¤–çš„è§¦å‘ã€‚


## EP02
```ts
const promise = new Promise((resolve, reject) => {
  console.log(1);
  resolve('success')
  console.log(2);
});
promise.then(() => {
  console.log(3);
});
console.log(4);
```

è¿™æ®µä»£ç å±•ç¤ºäº† Promise çš„æ‰§è¡Œé¡ºåºï¼ŒåŒ…æ‹¬åŒæ­¥ä»£ç å’Œå¼‚æ­¥ä»£ç çš„æ‰§è¡Œæµç¨‹ã€‚è®©æˆ‘ä»¬é€æ­¥è§£æï¼š

### ä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼š

1. **åˆ›å»º Promise å¯¹è±¡**ï¼š
   ```javascript
   const promise = new Promise((resolve, reject) => {
     console.log(1);       // åŒæ­¥æ‰§è¡Œï¼Œè¾“å‡º 1
     resolve('success');   // åŒæ­¥æ‰§è¡Œï¼ŒPromise çŠ¶æ€å˜ä¸º fulfilled
     console.log(2);       // åŒæ­¥æ‰§è¡Œï¼Œè¾“å‡º 2
   });
   ```
   - `new Promise` çš„ executor å‡½æ•°ä¼š**ç«‹å³åŒæ­¥æ‰§è¡Œ**ã€‚
   - è¾“å‡º `1` â†’ `resolve('success')` â†’ è¾“å‡º `2`ã€‚

2. **æ³¨å†Œ `.then` å›è°ƒ**ï¼š
   ```javascript
   promise.then(() => {
     console.log(3);       // å¾®ä»»åŠ¡ï¼Œç¨åæ‰§è¡Œ
   });
   ```
   - `.then` çš„å›è°ƒæ˜¯**å¼‚æ­¥çš„å¾®ä»»åŠ¡**ï¼Œä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚

3. **åŒæ­¥ä»£ç ç»§ç»­æ‰§è¡Œ**ï¼š
   ```javascript
   console.log(4);         // åŒæ­¥æ‰§è¡Œï¼Œè¾“å‡º 4
   ```
   - è¾“å‡º `4`ã€‚

4. **å¾®ä»»åŠ¡æ‰§è¡Œ**ï¼š
   - å½“å‰å®ä»»åŠ¡ï¼ˆåŒæ­¥ä»£ç ï¼‰æ‰§è¡Œå®Œæ¯•åï¼Œå¼€å§‹æ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚
   - æ‰§è¡Œ `.then` å›è°ƒï¼Œè¾“å‡º `3`ã€‚

### è¾“å‡ºç»“æœï¼š
```
1
2
4
3
```

### å…³é”®ç‚¹è¯´æ˜ï¼š
1. **Promise çš„ executor å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„**ï¼š
   - `console.log(1)`ã€`resolve('success')`ã€`console.log(2)` éƒ½æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚

2. **`.then` å›è°ƒæ˜¯å¼‚æ­¥çš„å¾®ä»»åŠ¡**ï¼š
   - å³ä½¿ Promise å·²ç» `resolve`ï¼Œ`.then` å›è°ƒä¹Ÿä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ç­‰å¾…å½“å‰å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åæ‰ä¼šæ‰§è¡Œã€‚

3. **äº‹ä»¶å¾ªç¯çš„é¡ºåº**ï¼š
   - åŒæ­¥ä»£ç ï¼ˆå®ä»»åŠ¡ï¼‰â†’ å¾®ä»»åŠ¡ï¼ˆPromise å›è°ƒï¼‰â†’ å®ä»»åŠ¡ï¼ˆå¦‚ `setTimeout`ï¼‰ã€‚

### æ‰©å±•ï¼šå¦‚æœåŠ ä¸Š `setTimeout`
```javascript
console.log(4);
setTimeout(() => console.log(5));  // å®ä»»åŠ¡
```

è¾“å‡ºé¡ºåºä¼šæ˜¯ï¼š
```
1
2
4
3
5
```
å› ä¸º `setTimeout` æ˜¯å®ä»»åŠ¡ï¼Œä¼šåœ¨å¾®ä»»åŠ¡ï¼ˆ`3`ï¼‰ä¹‹åæ‰§è¡Œã€‚


## EP03

è¿™æ®µä»£ç å±•ç¤ºäº† **Promise çš„æ‰§è¡Œé¡ºåº**ï¼ŒåŒ…æ‹¬åŒæ­¥ä»£ç å’Œå¼‚æ­¥ä»£ç çš„æ‰§è¡Œæµç¨‹ã€‚è®©æˆ‘ä»¬é€æ­¥è§£æï¼š

### ä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼š

1. **åˆ›å»º Promise å¯¹è±¡**ï¼š
   ```javascript
   const promise = new Promise((resolve, reject) => {
     console.log(1);  // åŒæ­¥æ‰§è¡Œï¼Œè¾“å‡º 1
     console.log(2);  // åŒæ­¥æ‰§è¡Œï¼Œè¾“å‡º 2
   });
   ```
   - `new Promise` çš„ **executor å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„**ï¼Œæ‰€ä»¥ä¼šç«‹å³æ‰§è¡Œ `console.log(1)` å’Œ `console.log(2)`ã€‚
   - **ä½† Promise æ²¡æœ‰è¢« `resolve` æˆ– `reject`**ï¼Œæ‰€ä»¥å®ƒçš„çŠ¶æ€ä»ç„¶æ˜¯ `pending`ã€‚

2. **æ³¨å†Œ `.then` å›è°ƒ**ï¼š
   ```javascript
   promise.then(() => {
     console.log(3);  // å¾®ä»»åŠ¡ï¼Œä½†ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸º Promise æœª resolve/reject
   });
   ```
   - `.then` çš„å›è°ƒæ˜¯**å¾®ä»»åŠ¡**ï¼Œä½†**åªæœ‰å½“ Promise è¢« `resolve` æˆ– `reject` æ—¶æ‰ä¼šæ‰§è¡Œ**ã€‚
   - ç”±äº Promise ä»ç„¶æ˜¯ `pending`ï¼Œ`console.log(3)` **ä¸ä¼šæ‰§è¡Œ**ã€‚

3. **åŒæ­¥ä»£ç ç»§ç»­æ‰§è¡Œ**ï¼š
   ```javascript
   console.log(4);  // åŒæ­¥æ‰§è¡Œï¼Œè¾“å‡º 4
   ```
   - è¾“å‡º `4`ã€‚

### æœ€ç»ˆè¾“å‡ºï¼š
```
1
2
4
```

### å…³é”®ç‚¹è¯´æ˜ï¼š
1. **Promise çš„ executor å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„**ï¼š
   - `console.log(1)` å’Œ `console.log(2)` ä¼šç«‹å³æ‰§è¡Œã€‚

2. **`.then` å›è°ƒåªæœ‰åœ¨ Promise çŠ¶æ€æ”¹å˜æ—¶æ‰ä¼šæ‰§è¡Œ**ï¼š
   - å¦‚æœ Promise **æ²¡æœ‰ `resolve` æˆ– `reject`**ï¼Œ`.then` å›è°ƒä¸ä¼šè§¦å‘ã€‚

3. **`console.log(3)` ä¸ä¼šæ‰§è¡Œ**ï¼š
   - å› ä¸º Promise ä¸€ç›´æ˜¯ `pending`ï¼Œæ²¡æœ‰è¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚

### å¯¹æ¯”ï¼šå¦‚æœ Promise è¢« `resolve`
```javascript
const promise = new Promise((resolve, reject) => {
  console.log(1);
  resolve();  // çŠ¶æ€å˜ä¸º fulfilled
  console.log(2);
});
promise.then(() => {
  console.log(3);  // å¾®ä»»åŠ¡ï¼Œä¼šåœ¨åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œ
});
console.log(4);
```
**è¾“å‡ºé¡ºåº**ï¼š
```
1
2
4
3
```
- å› ä¸º `resolve()` è¢«è°ƒç”¨ï¼Œ`.then` å›è°ƒä¼šåœ¨åŒæ­¥ä»£ç æ‰§è¡Œå®Œåæ‰§è¡Œã€‚


## EP04
```ts
const fn = () => (new Promise((resolve, reject) => {
  console.log(1);
  resolve('success')
}))
fn().then(res => {
  console.log(res)
})
console.log('start')
```

è¿™æ®µä»£ç å±•ç¤ºäº† **Promise çš„æ‰§è¡Œé¡ºåº**ï¼ŒåŒ…æ‹¬åŒæ­¥ä»£ç å’Œå¼‚æ­¥ä»£ç çš„æ‰§è¡Œæµç¨‹ã€‚è®©æˆ‘ä»¬é€æ­¥è§£æï¼š

### ä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼š

1. **å®šä¹‰ `fn` å‡½æ•°**ï¼š
   ```javascript
   const fn = () => (new Promise((resolve, reject) => {
     console.log(1);        // åŒæ­¥æ‰§è¡Œï¼Œè¾“å‡º 1
     resolve('success');    // åŒæ­¥æ‰§è¡Œï¼ŒPromise çŠ¶æ€å˜ä¸º fulfilled
   }));
   ```
   - `fn` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª `Promise`ã€‚
   - å½“ `fn()` è¢«è°ƒç”¨æ—¶ï¼Œ`new Promise` çš„ **executor å‡½æ•°ä¼šåŒæ­¥æ‰§è¡Œ**ï¼Œæ‰€ä»¥ `console.log(1)` ä¼šç«‹å³æ‰§è¡Œã€‚
   - `resolve('success')` ä¹Ÿä¼šåŒæ­¥æ‰§è¡Œï¼ŒPromise çŠ¶æ€å˜ä¸º `fulfilled`ã€‚

2. **è°ƒç”¨ `fn()` å¹¶æ³¨å†Œ `.then` å›è°ƒ**ï¼š
   ```javascript
   fn().then(res => {
     console.log(res);      // å¾®ä»»åŠ¡ï¼Œç¨åæ‰§è¡Œ
   });
   ```
   - `fn()` è¿”å›ä¸€ä¸ªå·²ç» `resolve('success')` çš„ Promiseã€‚
   - `.then` çš„å›è°ƒæ˜¯**å¾®ä»»åŠ¡**ï¼Œä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚

3. **åŒæ­¥ä»£ç ç»§ç»­æ‰§è¡Œ**ï¼š
   ```javascript
   console.log('start');    // åŒæ­¥æ‰§è¡Œï¼Œè¾“å‡º 'start'
   ```
   - è¾“å‡º `'start'`ã€‚

4. **å¾®ä»»åŠ¡æ‰§è¡Œ**ï¼š
   - å½“å‰å®ä»»åŠ¡ï¼ˆåŒæ­¥ä»£ç ï¼‰æ‰§è¡Œå®Œæ¯•åï¼Œå¼€å§‹æ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚
   - æ‰§è¡Œ `.then` å›è°ƒï¼Œè¾“å‡º `'success'`ï¼ˆ`res` çš„å€¼ï¼‰ã€‚

### æœ€ç»ˆè¾“å‡ºï¼š
```
1
start
success
```

### å…³é”®ç‚¹è¯´æ˜ï¼š
1. **`new Promise` çš„ executor å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„**ï¼š
   - `console.log(1)` å’Œ `resolve('success')` ä¼šç«‹å³æ‰§è¡Œã€‚

2. **`.then` å›è°ƒæ˜¯å¼‚æ­¥çš„å¾®ä»»åŠ¡**ï¼š
   - å³ä½¿ Promise å·²ç» `resolve`ï¼Œ`.then` å›è°ƒä¹Ÿä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ç­‰å¾…å½“å‰å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚

3. **äº‹ä»¶å¾ªç¯çš„é¡ºåº**ï¼š
   - åŒæ­¥ä»£ç ï¼ˆå®ä»»åŠ¡ï¼‰â†’ å¾®ä»»åŠ¡ï¼ˆPromise å›è°ƒï¼‰â†’ å®ä»»åŠ¡ï¼ˆå¦‚ `setTimeout`ï¼‰ã€‚

### æ‰©å±•ï¼šå¦‚æœåŠ ä¸Š `setTimeout`
```javascript
console.log('start');
setTimeout(() => console.log('timeout'));  // å®ä»»åŠ¡
```
è¾“å‡ºé¡ºåºä¼šæ˜¯ï¼š
```
1
start
success
timeout
```
å› ä¸º `setTimeout` æ˜¯å®ä»»åŠ¡ï¼Œä¼šåœ¨å¾®ä»»åŠ¡ï¼ˆ`success`ï¼‰ä¹‹åæ‰§è¡Œã€‚

## EP5

```ts
const promise = new Promise((resolve, reject) => {
  reject("error");
  resolve("success2");
});
promise
.then(res => {
    console.log("then1: ", res);
  }).then(res => {
    console.log("then2: ", res);
  }).catch(err => {
    console.log("catch: ", err);
  }).then(res => {
    console.log("then3: ", res);
  })
```

è¿™æ®µä»£ç å±•ç¤ºäº† **Promise é“¾å¼è°ƒç”¨** çš„æ‰§è¡Œæµç¨‹ï¼Œç‰¹åˆ«æ˜¯ `reject` å’Œ `catch` çš„å¤„ç†é€»è¾‘ã€‚è®©æˆ‘ä»¬é€æ­¥è§£æï¼š

### ä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼š

1. **åˆ›å»º Promise å¹¶ç«‹å³ `reject`**ï¼š
   ```javascript
   const promise = new Promise((resolve, reject) => {
     reject("error");      // Promise çŠ¶æ€å˜ä¸º rejected
     resolve("success2");  // æ— æ•ˆï¼Œå› ä¸º Promise çŠ¶æ€å·²ç»é”å®š
   });
   ```
   - `reject("error")` ä¼šç«‹å³å°† Promise çŠ¶æ€è®¾ä¸º `rejected`ï¼Œå¹¶æºå¸¦é”™è¯¯ä¿¡æ¯ `"error"`ã€‚
   - `resolve("success2")` **ä¸ä¼šç”Ÿæ•ˆ**ï¼Œå› ä¸º Promise çš„çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼ˆ`rejected` æˆ– `fulfilled`ï¼‰ï¼Œå°±ä¸èƒ½å†æ”¹å˜ã€‚

2. **é“¾å¼è°ƒç”¨ `.then` å’Œ `.catch`**ï¼š
   ```javascript
   promise
     .then(res => {
       console.log("then1: ", res);  // è·³è¿‡ï¼Œå› ä¸º Promise å·² rejected
     })
     .then(res => {
       console.log("then2: ", res);  // è·³è¿‡
     })
     .catch(err => {
       console.log("catch: ", err);  // æ•è·é”™è¯¯ï¼Œè¾“å‡º "catch: error"
     })
     .then(res => {
       console.log("then3: ", res);  // æ‰§è¡Œï¼Œè¾“å‡º "then3: undefined"
     });
   ```

### æ‰§è¡Œæµç¨‹è§£æï¼š
1. **`reject("error")`**ï¼š
   - Promise ç›´æ¥è¿›å…¥ `rejected` çŠ¶æ€ï¼Œåç»­çš„ `resolve("success2")` è¢«å¿½ç•¥ã€‚

2. **ç¬¬ä¸€ä¸ª `.then`**ï¼š
   - ç”±äº Promise æ˜¯ `rejected`ï¼Œç¬¬ä¸€ä¸ª `.then` çš„å›è°ƒï¼ˆ`then1`ï¼‰**ä¸ä¼šæ‰§è¡Œ**ï¼Œç›´æ¥è·³åˆ°åç»­çš„ `.catch`ã€‚

3. **ç¬¬äºŒä¸ª `.then`**ï¼š
   - ç”±äºå‰ä¸€ä¸ª `.then` è¢«è·³è¿‡ï¼Œç¬¬äºŒä¸ª `.then`ï¼ˆ`then2`ï¼‰**ä¹Ÿä¸ä¼šæ‰§è¡Œ**ã€‚

4. **`.catch`**ï¼š
   - æ•è·åˆ° `reject("error")` çš„é”™è¯¯ï¼Œè¾“å‡º `"catch: error"`ã€‚
   - `.catch` è¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼Œé»˜è®¤æ˜¯ `fulfilled` çŠ¶æ€ï¼ˆé™¤é `.catch` å†…éƒ¨æŠ›å‡ºé”™è¯¯ï¼‰ã€‚

5. **æœ€åä¸€ä¸ª `.then`ï¼ˆ`then3`ï¼‰**ï¼š
   - ç”±äº `.catch` æ²¡æœ‰æ˜¾å¼è¿”å›ä»»ä½•å€¼ï¼Œ`res` æ˜¯ `undefined`ï¼Œæ‰€ä»¥è¾“å‡º `"then3: undefined"`ã€‚

### æœ€ç»ˆè¾“å‡ºï¼š
```
catch: error
then3: undefined
```

### å…³é”®ç‚¹æ€»ç»“ï¼š
1. **Promise çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼ˆ`rejected`/`fulfilled`ï¼‰ï¼Œå°±ä¸èƒ½å†æ”¹å˜**ã€‚
   - `reject("error")` åï¼Œ`resolve("success2")` æ— æ•ˆã€‚

2. **`.then` åªæœ‰åœ¨ Promise æ˜¯ `fulfilled` æ—¶æ‰ä¼šæ‰§è¡Œ**ï¼š
   - å¦‚æœ Promise æ˜¯ `rejected`ï¼Œ`.then` ä¼šè¢«è·³è¿‡ï¼Œç›´æ¥è¿›å…¥ `.catch`ã€‚

3. **`.catch` ä¼šæ•è·ä¹‹å‰çš„é”™è¯¯ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ `fulfilled` Promise**ï¼š
   - é™¤é `.catch` å†…éƒ¨å†æ¬¡æŠ›å‡ºé”™è¯¯ï¼Œå¦åˆ™åç»­çš„ `.then` ä¼šæ­£å¸¸æ‰§è¡Œã€‚

4. **å¦‚æœ `.then` æˆ– `.catch` æ²¡æœ‰è¿”å›å€¼ï¼Œ`res` ä¼šæ˜¯ `undefined`**ï¼š
   - æœ€åä¸€ä¸ª `then3` çš„ `res` æ˜¯ `undefined`ï¼Œå› ä¸º `.catch` æ²¡æœ‰è¿”å›ä»»ä½•å€¼ã€‚

### æ‰©å±•ï¼šå¦‚æœ `.catch` è¿”å›ä¸€ä¸ªå€¼
```javascript
.catch(err => {
  console.log("catch: ", err);
  return "recovered";  // è¿”å›ä¸€ä¸ªå€¼
})
.then(res => {
  console.log("then3: ", res);  // è¾“å‡º "then3: recovered"
})
```
**è¾“å‡º**ï¼š
```
catch: error
then3: recovered
```
- å› ä¸º `.catch` è¿”å›äº† `"recovered"`ï¼Œæ‰€ä»¥ `then3` çš„ `res` æ˜¯è¿™ä¸ªå€¼ã€‚

## EP06

```ts
const fn = () =>
  new Promise((resolve, reject) => {
    console.log(1);
    resolve("success");
  });
console.log("start");
fn().then(res => {
  console.log(res);
});
```

è¿™æ®µä»£ç çš„æ‰§è¡Œé¡ºåºæ¶‰åŠ **åŒæ­¥ä»£ç ** å’Œ **Promise çš„å¼‚æ­¥æ‰§è¡Œæœºåˆ¶**ã€‚è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æï¼š

### ä»£ç æ‰§è¡Œæµç¨‹ï¼š

1. **å®šä¹‰ `fn` å‡½æ•°ï¼ˆåŒæ­¥ï¼‰**ï¼š
   ```javascript
   const fn = () =>
     new Promise((resolve, reject) => {
       console.log(1);        // åŒæ­¥ä»£ç ï¼ˆåœ¨ Promise æ„é€ æ—¶æ‰§è¡Œï¼‰
       resolve("success");    // åŒæ­¥æ‰§è¡Œï¼ŒPromise çŠ¶æ€å˜ä¸º fulfilled
     });
   ```
   - `fn` æ˜¯ä¸€ä¸ªè¿”å› Promise çš„å‡½æ•°ï¼Œä½†æ­¤æ—¶**å‡½æ•°å°šæœªè°ƒç”¨**ï¼Œæ‰€ä»¥ `console.log(1)` è¿˜æ²¡æ‰§è¡Œã€‚

2. **åŒæ­¥ä»£ç  `console.log("start")`**ï¼š
   ```javascript
   console.log("start");      // åŒæ­¥ä»£ç ï¼Œç«‹å³æ‰§è¡Œ
   ```
   - è¾“å‡º `"start"`ã€‚

3. **è°ƒç”¨ `fn()`ï¼ˆåŒæ­¥ + å¼‚æ­¥ï¼‰**ï¼š
   ```javascript
   fn().then(res => {        // è°ƒç”¨ fn()ï¼Œè§¦å‘ Promise æ‰§è¡Œ
     console.log(res);       // å¼‚æ­¥å¾®ä»»åŠ¡ï¼Œç¨åæ‰§è¡Œ
   });
   ```
   - `fn()` è°ƒç”¨æ—¶ï¼Œ`new Promise` çš„ **executor å‡½æ•°åŒæ­¥æ‰§è¡Œ**ï¼š
     - è¾“å‡º `1`ã€‚
     - `resolve("success")` å°† Promise çŠ¶æ€è®¾ä¸º `fulfilled`ã€‚
   - `.then(res => { console.log(res) })` æ˜¯**å¾®ä»»åŠ¡**ï¼Œä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚

4. **å¾®ä»»åŠ¡æ‰§è¡Œ**ï¼š
   - å½“å‰**å®ä»»åŠ¡ï¼ˆåŒæ­¥ä»£ç ï¼‰æ‰§è¡Œå®Œæ¯•å**ï¼Œå¼€å§‹æ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚
   - æ‰§è¡Œ `.then` å›è°ƒï¼Œè¾“å‡º `"success"`ï¼ˆ`res` çš„å€¼ï¼‰ã€‚

### æœ€ç»ˆè¾“å‡ºé¡ºåºï¼š
```
start
1
success
```

### å…³é”®ç‚¹è§£æï¼š
1. **`new Promise` çš„ executor å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„**ï¼š
   - å½“ `fn()` è¢«è°ƒç”¨æ—¶ï¼Œ`console.log(1)` å’Œ `resolve("success")` ä¼šç«‹å³æ‰§è¡Œã€‚

2. **`.then` å›è°ƒæ˜¯å¼‚æ­¥çš„å¾®ä»»åŠ¡**ï¼š
   - å³ä½¿ Promise å·²ç» `resolve`ï¼Œ`.then` å›è°ƒä¹Ÿè¦ç­‰åˆ°åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åæ‰ä¼šæ‰§è¡Œã€‚

3. **äº‹ä»¶å¾ªç¯çš„é¡ºåº**ï¼š
   - åŒæ­¥ä»£ç ï¼ˆ`console.log("start")`ï¼‰â†’ Promise çš„åŒæ­¥éƒ¨åˆ†ï¼ˆ`console.log(1)`ï¼‰â†’ å¾®ä»»åŠ¡ï¼ˆ`.then` å›è°ƒï¼‰ã€‚

### å¸¸è§è¯¯åŒºï¼š
- **è¯¯ä»¥ä¸º `console.log(1)` ä¼šåœ¨ `console.log("start")` ä¹‹å‰æ‰§è¡Œ**ï¼š  
  å®é™…ä¸Šï¼Œ`fn` å‡½æ•°åªæœ‰è¢«è°ƒç”¨æ—¶æ‰ä¼šæ‰§è¡Œå†…éƒ¨çš„ä»£ç ï¼Œè€Œ `console.log("start")` æ˜¯åœ¨è°ƒç”¨ `fn()` ä¹‹å‰æ‰§è¡Œçš„åŒæ­¥ä»£ç ã€‚

- **è¯¯ä»¥ä¸º `console.log(res)` ä¼šç«‹å³æ‰§è¡Œ**ï¼š  
  `.then` æ˜¯å¼‚æ­¥çš„ï¼Œå¿…é¡»ç­‰å¾…å½“å‰è°ƒç”¨æ ˆæ¸…ç©ºï¼ˆå³åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼‰åæ‰ä¼šæ‰§è¡Œã€‚

### æ€»ç»“ï¼š
Promise çš„ **executor å‡½æ•°ï¼ˆ`new Promise` å†…éƒ¨çš„å‡½æ•°ï¼‰æ˜¯åŒæ­¥æ‰§è¡Œçš„**ï¼Œä½† **`.then`/`.catch` æ˜¯å¼‚æ­¥çš„å¾®ä»»åŠ¡**ã€‚ç†è§£è¿™ä¸€ç‚¹æ˜¯æŒæ¡ Promise æ‰§è¡Œé¡ºåºçš„å…³é”®ï¼

## EP07
```ts
console.log('start')
setTimeout(() => {
  console.log('time')
})
Promise.resolve().then(() => {
  console.log('resolve')
})
console.log('end')
```

è¿™æ®µä»£ç çš„æ‰§è¡Œé¡ºåºæ¶‰åŠ **åŒæ­¥ä»£ç ã€å¾®ä»»åŠ¡ï¼ˆMicrotaskï¼‰å’Œå®ä»»åŠ¡ï¼ˆMacrotaskï¼‰** çš„æ‰§è¡Œæœºåˆ¶ã€‚è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æï¼š

---

### **ä»£ç æ‰§è¡Œæµç¨‹ï¼š**

1. **åŒæ­¥ä»£ç æ‰§è¡Œ**ï¼š
   ```javascript
   console.log('start')    // åŒæ­¥ä»£ç ï¼Œç«‹å³æ‰§è¡Œ
   ```
   - **è¾“å‡º**: `'start'`

2. **`setTimeout` å®‰æ’å®ä»»åŠ¡**ï¼š
   ```javascript
   setTimeout(() => {
     console.log('time')   // å®ä»»åŠ¡ï¼Œæ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—
   })
   ```
   - `setTimeout` çš„å›è°ƒæ˜¯**å®ä»»åŠ¡**ï¼Œä¼šè¢«æ”¾å…¥ **å®ä»»åŠ¡é˜Ÿåˆ—**ï¼Œç­‰å¾…å½“å‰è°ƒç”¨æ ˆæ¸…ç©ºåæ‰§è¡Œã€‚

3. **`Promise.resolve().then` å®‰æ’å¾®ä»»åŠ¡**ï¼š
   ```javascript
   Promise.resolve().then(() => {
     console.log('resolve')  // å¾®ä»»åŠ¡ï¼Œæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—
   })
   ```
   - `Promise.resolve().then` çš„å›è°ƒæ˜¯**å¾®ä»»åŠ¡**ï¼Œä¼šè¢«æ”¾å…¥ **å¾®ä»»åŠ¡é˜Ÿåˆ—**ï¼Œä¼˜å…ˆçº§é«˜äºå®ä»»åŠ¡ã€‚

4. **åŒæ­¥ä»£ç ç»§ç»­æ‰§è¡Œ**ï¼š
   ```javascript
   console.log('end')      // åŒæ­¥ä»£ç ï¼Œç«‹å³æ‰§è¡Œ
   ```
   - **è¾“å‡º**: `'end'`

5. **å½“å‰è°ƒç”¨æ ˆæ¸…ç©ºï¼Œå¼€å§‹æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—**ï¼š
   - å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰ `() => { console.log('resolve') }`ï¼Œæ‰€ä»¥æ‰§è¡Œå®ƒã€‚
   - **è¾“å‡º**: `'resolve'`

6. **å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºåï¼Œæ‰§è¡Œå®ä»»åŠ¡**ï¼š
   - å®ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰ `setTimeout` çš„å›è°ƒï¼Œæ‰€ä»¥æ‰§è¡Œå®ƒã€‚
   - **è¾“å‡º**: `'time'`

---

### **æœ€ç»ˆè¾“å‡ºé¡ºåºï¼š**
```
start
end
resolve
time
```

---

### **å…³é”®ç‚¹è§£æï¼š**
1. **åŒæ­¥ä»£ç æœ€å…ˆæ‰§è¡Œ**ï¼š
   - `console.log('start')` å’Œ `console.log('end')` æ˜¯åŒæ­¥ä»£ç ï¼Œä¼šç«‹å³æ‰§è¡Œã€‚

2. **å¾®ä»»åŠ¡ï¼ˆMicrotaskï¼‰ä¼˜å…ˆäºå®ä»»åŠ¡ï¼ˆMacrotaskï¼‰**ï¼š
   - `Promise.then` æ˜¯å¾®ä»»åŠ¡ï¼Œ`setTimeout` æ˜¯å®ä»»åŠ¡ã€‚
   - **å¾®ä»»åŠ¡ä¼šåœ¨å½“å‰å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åç«‹å³æ‰§è¡Œ**ï¼Œè€Œå®ä»»åŠ¡è¦ç­‰åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ã€‚

3. **äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰çš„é¡ºåº**ï¼š
   - åŒæ­¥ä»£ç ï¼ˆå®ä»»åŠ¡çš„ä¸€éƒ¨åˆ†ï¼‰â†’ å¾®ä»»åŠ¡ â†’ å®ä»»åŠ¡ï¼ˆå¦‚ `setTimeout`ï¼‰ã€‚

---

### **æ‰©å±•ï¼šå¦‚æœä»£ç æ›´å¤æ‚**
```javascript
console.log('start')

setTimeout(() => {
  console.log('timeout1')
  Promise.resolve().then(() => {
    console.log('promise1 in timeout')
  })
}, 0)

Promise.resolve().then(() => {
  console.log('promise1')
  setTimeout(() => {
    console.log('timeout2 in promise')
  }, 0)
})

console.log('end')
```
**è¾“å‡ºé¡ºåº**ï¼š
```
start
end
promise1
timeout1
promise1 in timeout
timeout2 in promise
```
- **åŸå› **ï¼š
  1. åŒæ­¥ä»£ç  `start` â†’ `end`ã€‚
  2. å¾®ä»»åŠ¡ `promise1` å…ˆæ‰§è¡Œã€‚
  3. å®ä»»åŠ¡ `timeout1` æ‰§è¡Œï¼Œå¹¶åœ¨å…¶ä¸­äº§ç”Ÿæ–°çš„å¾®ä»»åŠ¡ `promise1 in timeout`ã€‚
  4. å¾®ä»»åŠ¡ä¼˜å…ˆçº§é«˜ï¼Œæ‰€ä»¥ `promise1 in timeout` å…ˆäº `timeout2 in promise` æ‰§è¡Œã€‚

---

### **æ€»ç»“**
- **åŒæ­¥ä»£ç  > å¾®ä»»åŠ¡ï¼ˆ`Promise.then`ï¼‰ > å®ä»»åŠ¡ï¼ˆ`setTimeout`ï¼‰**ã€‚
- å¾®ä»»åŠ¡ä¼šåœ¨å½“å‰å®ä»»åŠ¡ç»“æŸåç«‹å³æ‰§è¡Œï¼Œè€Œå®ä»»åŠ¡è¦ç­‰åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ã€‚
- æŒæ¡è¿™ä¸ªé¡ºåºæ˜¯ç†è§£ JavaScript å¼‚æ­¥ç¼–ç¨‹çš„å…³é”®ï¼

## EP07
```ts
const promise1 = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve("success");
    console.log("timer1");
  }, 1000);
  console.log("promise1é‡Œçš„å†…å®¹");
});
const promise2 = promise1.then(() => {
  throw new Error("error!!!");
});
console.log("promise1", promise1);
console.log("promise2", promise2);
setTimeout(() => {
  console.log("timer2");
  console.log("promise1", promise1);
  console.log("promise2", promise2);
}, 2000);
```

è¿™æ®µä»£ç æ¶‰åŠ **Promise çš„å¼‚æ­¥æ‰§è¡Œã€é“¾å¼è°ƒç”¨ã€é”™è¯¯å¤„ç†å’Œ `setTimeout` çš„æ‰§è¡Œé¡ºåº**ã€‚è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†ææ‰§è¡Œæµç¨‹å’Œè¾“å‡ºç»“æœã€‚

---

## **ä»£ç æ‰§è¡Œæµç¨‹åˆ†æ**

### **1. åˆ›å»º `promise1`**
```javascript
const promise1 = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve("success");    // 1ç§’å resolve
    console.log("timer1"); // 1ç§’åè¾“å‡º
  }, 1000);
  console.log("promise1é‡Œçš„å†…å®¹");  // åŒæ­¥ä»£ç ï¼Œç«‹å³æ‰§è¡Œ
});
```
- **åŒæ­¥æ‰§è¡Œéƒ¨åˆ†**ï¼š
  - `console.log("promise1é‡Œçš„å†…å®¹")` â†’ **è¾“å‡º `"promise1é‡Œçš„å†…å®¹"`**
- **å¼‚æ­¥éƒ¨åˆ†**ï¼š
  - `setTimeout` çš„å›è°ƒä¼šåœ¨ **1ç§’å** æ‰§è¡Œï¼š
    - `resolve("success")` â†’ `promise1` çŠ¶æ€å˜ä¸º `fulfilled`
    - `console.log("timer1")` â†’ **è¾“å‡º `"timer1"`**

---

### **2. `promise1.then()` åˆ›å»º `promise2`**
```javascript
const promise2 = promise1.then(() => {
  throw new Error("error!!!");  // æŠ›å‡ºé”™è¯¯ï¼Œpromise2 å˜ä¸º rejected
});
```
- `promise1.then()` è¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼ˆ`promise2`ï¼‰ã€‚
- **æ­¤æ—¶ `promise1` è¿˜æ˜¯ `pending` çŠ¶æ€**ï¼Œæ‰€ä»¥ `promise2` ä¹Ÿå¤„äº `pending` çŠ¶æ€ã€‚
- å½“ `promise1` åœ¨ **1ç§’å** `resolve("success")`ï¼Œ`then` å›è°ƒæ‰§è¡Œï¼š
  - `throw new Error("error!!!")` â†’ `promise2` å˜ä¸º `rejected`ï¼Œé”™è¯¯ä¿¡æ¯æ˜¯ `"error!!!"`ã€‚

---

### **3. åŒæ­¥è¾“å‡º `promise1` å’Œ `promise2`**
```javascript
console.log("promise1", promise1);
console.log("promise2", promise2);
```
- **æ­¤æ—¶ `promise1` çš„çŠ¶æ€**ï¼š
  - `pending`ï¼ˆå› ä¸º `resolve` åœ¨ `setTimeout` é‡Œï¼Œè¿˜æ²¡æ‰§è¡Œï¼‰
- **æ­¤æ—¶ `promise2` çš„çŠ¶æ€**ï¼š
  - `pending`ï¼ˆå› ä¸º `promise1` è¿˜æ²¡ `resolve`ï¼‰
- **è¾“å‡º**ï¼š
  ```
  promise1 Promise { <pending> }
  promise2 Promise { <pending> }
  ```

---

### **4. ç¬¬äºŒä¸ª `setTimeout`ï¼ˆ2ç§’åæ‰§è¡Œï¼‰**
```javascript
setTimeout(() => {
  console.log("timer2");
  console.log("promise1", promise1);
  console.log("promise2", promise2);
}, 2000);
```
- **2ç§’å**ï¼Œæ‰§è¡Œå›è°ƒï¼š
  1. `console.log("timer2")` â†’ **è¾“å‡º `"timer2"`**
  2. **æ£€æŸ¥ `promise1` çš„çŠ¶æ€**ï¼š
     - 1ç§’æ—¶ `promise1` å·²ç» `resolve("success")`ï¼Œæ‰€ä»¥ç°åœ¨æ˜¯ `fulfilled`ã€‚
     - **è¾“å‡º**ï¼š
       ```
       promise1 Promise { "success" }
       ```
  3. **æ£€æŸ¥ `promise2` çš„çŠ¶æ€**ï¼š
     - `promise1.then()` çš„å›è°ƒæŠ›å‡ºäº†é”™è¯¯ï¼Œæ‰€ä»¥ `promise2` æ˜¯ `rejected`ã€‚
     - **è¾“å‡º**ï¼š
       ```
       promise2 Promise { <rejected> Error: error!!! }
       ```

---

## **æœ€ç»ˆè¾“å‡ºé¡ºåº**
1. `"promise1é‡Œçš„å†…å®¹"`ï¼ˆåŒæ­¥ä»£ç ï¼‰
2. `"promise1 Promise { <pending> }"`ï¼ˆåŒæ­¥ä»£ç ï¼‰
3. `"promise2 Promise { <pending> }"`ï¼ˆåŒæ­¥ä»£ç ï¼‰
4. `"timer1"`ï¼ˆ1ç§’åï¼Œ`promise1` çš„ `setTimeout`ï¼‰
5. `"timer2"`ï¼ˆ2ç§’åï¼Œç¬¬äºŒä¸ª `setTimeout`ï¼‰
6. `"promise1 Promise { "success" }"`ï¼ˆ`promise1` å·² `resolve`ï¼‰
7. `"promise2 Promise { <rejected> Error: error!!! }"`ï¼ˆ`promise2` å› é”™è¯¯è¢« `rejected`ï¼‰

### **å®Œæ•´è¾“å‡ºï¼š**
```
promise1é‡Œçš„å†…å®¹
promise1 Promise { <pending> }
promise2 Promise { <pending> }
timer1
timer2
promise1 Promise { "success" }
promise2 Promise { <rejected> Error: error!!! }
```

---

## **å…³é”®ç‚¹æ€»ç»“**
1. **`new Promise` çš„ executor å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„**ï¼Œä½† `resolve`/`reject` å¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼ˆå¦‚æ”¾åœ¨ `setTimeout` é‡Œï¼‰ã€‚
2. **`promise.then()` è¿”å›ä¸€ä¸ªæ–°çš„ Promise**ï¼Œå®ƒçš„çŠ¶æ€å–å†³äºå›è°ƒçš„æ‰§è¡Œæƒ…å†µï¼š
   - å¦‚æœå›è°ƒæŠ›å‡ºé”™è¯¯ï¼ˆ`throw`ï¼‰ï¼Œæ–° Promise ä¼š `rejected`ã€‚
3. **`setTimeout` æ˜¯å®ä»»åŠ¡**ï¼Œ`Promise.then` æ˜¯å¾®ä»»åŠ¡ï¼š
   - å¾®ä»»åŠ¡ä¼šåœ¨å½“å‰å®ä»»åŠ¡ç»“æŸåç«‹å³æ‰§è¡Œï¼Œè€Œå®ä»»åŠ¡è¦ç­‰ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ã€‚
4. **Promise çš„çŠ¶æ€å˜åŒ–æ˜¯å¼‚æ­¥çš„**ï¼Œæ‰€ä»¥åŒæ­¥ä»£ç æ‰§è¡Œæ—¶å¯èƒ½è¿˜æ˜¯ `pending`ã€‚

---

## **æ‰©å±•æ€è€ƒ**
å¦‚æœ `promise1.then()` é‡Œä¸æŠ›å‡ºé”™è¯¯ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªå€¼ï¼š
```javascript
const promise2 = promise1.then(() => {
  return "new value";
});
```
**`promise2` çš„çŠ¶æ€ä¼šæ˜¯ä»€ä¹ˆï¼Ÿ**
- `promise2` ä¼š `resolve("new value")`ï¼Œè¾“å‡ºï¼š
  ```
  promise2 Promise { "new value" }
  ```

---

### **æ€»ç»“**
- **åŒæ­¥ä»£ç æœ€å…ˆæ‰§è¡Œ**ã€‚
- **`Promise` çš„çŠ¶æ€å˜åŒ–å¯èƒ½æ˜¯å¼‚æ­¥çš„**ï¼ˆå¦‚ `setTimeout` é‡Œçš„ `resolve`ï¼‰ã€‚
- **`promise.then()` è¿”å›çš„æ–° Promise çš„çŠ¶æ€å–å†³äºå›è°ƒçš„æ‰§è¡Œæƒ…å†µ**ï¼ˆæ­£å¸¸è¿”å› â†’ `fulfilled`ï¼ŒæŠ›å‡ºé”™è¯¯ â†’ `rejected`ï¼‰ã€‚
- **å¾®ä»»åŠ¡ï¼ˆ`Promise.then`ï¼‰ä¼˜å…ˆäºå®ä»»åŠ¡ï¼ˆ`setTimeout`ï¼‰æ‰§è¡Œ**ã€‚

æŒæ¡è¿™äº›æ¦‚å¿µï¼Œå°±èƒ½è½»æ¾åˆ†æå¤æ‚çš„ Promise æ‰§è¡Œé¡ºåºï¼ ğŸš€

## EP09
```ts
const promise = new Promise((resolve, reject) => {
  resolve("success1");
  reject("error");
  resolve("success2");
});
promise
.then(res => {
    console.log("then: ", res);
  }).catch(err => {
    console.log("catch: ", err);
  })
```

è¿™æ®µä»£ç å±•ç¤ºäº† **Promise çš„çŠ¶æ€å˜åŒ–è§„åˆ™** å’Œ **é“¾å¼è°ƒç”¨çš„æ‰§è¡Œé¡ºåº**ã€‚è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æå®ƒçš„æ‰§è¡Œæµç¨‹å’Œè¾“å‡ºç»“æœã€‚

---

## **ä»£ç æ‰§è¡Œæµç¨‹åˆ†æ**

### **1. `new Promise` çš„åŒæ­¥æ‰§è¡Œ**
```javascript
const promise = new Promise((resolve, reject) => {
  resolve("success1");  // Promise çŠ¶æ€å˜ä¸º fulfilled
  reject("error");      // æ— æ•ˆï¼Œå› ä¸ºçŠ¶æ€å·²ç»é”å®š
  resolve("success2");  // æ— æ•ˆï¼Œå› ä¸ºçŠ¶æ€å·²ç»é”å®š
});
```
- **`resolve("success1")`**ï¼š
  - **Promise çŠ¶æ€ç«‹å³å˜ä¸º `fulfilled`**ï¼Œå¹¶ä¸”å€¼è®¾ä¸º `"success1"`ã€‚
- **`reject("error")` å’Œ `resolve("success2")`**ï¼š
  - **ä¸ä¼šç”Ÿæ•ˆ**ï¼Œå› ä¸º Promise çš„çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼ˆ`fulfilled` æˆ– `rejected`ï¼‰ï¼Œå°±ä¸èƒ½å†æ›´æ”¹ã€‚

---

### **2. `promise.then().catch()` é“¾å¼è°ƒç”¨**
```javascript
promise
  .then(res => {
    console.log("then: ", res);  // æ‰§è¡Œï¼Œå› ä¸º promise æ˜¯ fulfilled
  })
  .catch(err => {
    console.log("catch: ", err); // ä¸ä¼šæ‰§è¡Œ
  });
```
- **`.then` å›è°ƒæ‰§è¡Œ**ï¼š
  - å› ä¸º `promise` å·²ç»æ˜¯ `fulfilled`ï¼Œæ‰€ä»¥ `then` çš„å›è°ƒä¼šæ‰§è¡Œï¼Œå¹¶æ¥æ”¶ `"success1"`ã€‚
  - **è¾“å‡º**ï¼š
    ```
    then: success1
    ```
- **`.catch` ä¸ä¼šæ‰§è¡Œ**ï¼š
  - å› ä¸º `promise` æ²¡æœ‰è¿›å…¥ `rejected` çŠ¶æ€ï¼Œä¸” `.then` ä¹Ÿæ²¡æœ‰æŠ›å‡ºé”™è¯¯ã€‚

---

## **æœ€ç»ˆè¾“å‡º**
```
then: success1
```

---

## **å…³é”®ç‚¹æ€»ç»“**
1. **Promise çš„çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼ˆ`fulfilled` æˆ– `rejected`ï¼‰ï¼Œå°±ä¸èƒ½å†æ›´æ”¹**ï¼š
   - `resolve("success1")` ä¹‹åï¼Œ`reject("error")` å’Œ `resolve("success2")` **æ— æ•ˆ**ã€‚
2. **`.then` åªä¼šåœ¨ Promise `fulfilled` æ—¶æ‰§è¡Œ**ï¼š
   - è¿™é‡Œ `promise` å·²ç» `resolve("success1")`ï¼Œæ‰€ä»¥ `.then` å›è°ƒæ‰§è¡Œã€‚
3. **`.catch` åªä¼šåœ¨ Promise `rejected` æˆ–å‰é¢çš„ `.then` æŠ›å‡ºé”™è¯¯æ—¶æ‰§è¡Œ**ï¼š
   - è¿™é‡Œæ²¡æœ‰é”™è¯¯å‘ç”Ÿï¼Œæ‰€ä»¥ `.catch` ä¸ä¼šæ‰§è¡Œã€‚
4. **Promise çš„ executor å‡½æ•°ï¼ˆ`new Promise` é‡Œçš„å‡½æ•°ï¼‰æ˜¯åŒæ­¥æ‰§è¡Œçš„**ï¼š
   - `resolve("success1")` æ˜¯åŒæ­¥è°ƒç”¨çš„ï¼Œè€Œä¸æ˜¯å¼‚æ­¥çš„ã€‚

---

## **æ‰©å±•æ€è€ƒ**
### **å¦‚æœ `resolve` æ˜¯å¼‚æ­¥çš„ï¼ˆæ¯”å¦‚æ”¾åœ¨ `setTimeout` é‡Œï¼‰ï¼Ÿ**
```javascript
const promise = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve("success1");
    reject("error");
  }, 1000);
});
promise
  .then(res => console.log("then:", res))
  .catch(err => console.log("catch:", err));
```
**è¾“å‡º**ï¼š
```
then: success1
```
- è™½ç„¶ `reject("error")` åœ¨ `resolve("success1")` ä¹‹åè°ƒç”¨ï¼Œä½† **`resolve` å·²ç»é”å®šçŠ¶æ€**ï¼Œ`reject` ä¸ä¼šç”Ÿæ•ˆã€‚

---

### **å¦‚æœ `then` æŠ›å‡ºé”™è¯¯ï¼Œ`catch` ä¼šæ•è·å—ï¼Ÿ**
```javascript
const promise = new Promise((resolve, reject) => {
  resolve("success1");
});
promise
  .then(res => {
    console.log("then:", res);
    throw new Error("oops!");  // æŠ›å‡ºé”™è¯¯
  })
  .catch(err => {
    console.log("catch:", err);  // æ•è·é”™è¯¯
  });
```
**è¾“å‡º**ï¼š
```
then: success1
catch: Error: oops!
```
- **`then` æŠ›å‡ºé”™è¯¯ä¼šå¯¼è‡´é“¾å¼è°ƒç”¨çš„ä¸‹ä¸€ä¸ª `.catch` æ‰§è¡Œ**ã€‚

---

## **æ€»ç»“**
- **Promise çš„çŠ¶æ€åªèƒ½æ”¹å˜ä¸€æ¬¡**ï¼ˆ`resolve` æˆ– `reject` åä¸èƒ½å†æ›´æ”¹ï¼‰ã€‚
- **`.then` åœ¨ `fulfilled` æ—¶æ‰§è¡Œï¼Œ`.catch` åœ¨ `rejected` æ—¶æ‰§è¡Œ**ã€‚
- **å¦‚æœ `then` æŠ›å‡ºé”™è¯¯ï¼Œä¼šè¢«åç»­çš„ `catch` æ•è·**ã€‚
- **Promise çš„ executor å‡½æ•°ï¼ˆ`new Promise` é‡Œçš„ä»£ç ï¼‰æ˜¯åŒæ­¥æ‰§è¡Œçš„**ï¼Œä½† `then/catch` æ˜¯å¼‚æ­¥çš„ï¼ˆå¾®ä»»åŠ¡ï¼‰ã€‚

æŒæ¡è¿™äº›è§„åˆ™ï¼Œå°±èƒ½è½»æ¾åˆ†æ Promise çš„æ‰§è¡Œé¡ºåºï¼ ğŸš€


## EP10
```ts
Promise.resolve(1)
  .then(res => {
    console.log(res);
    return 2;
  })
  .catch(err => {
    return 3;
  })
  .then(res => {
    console.log(res);
  });
```
è¿™æ®µä»£ç å±•ç¤ºäº† **Promise é“¾å¼è°ƒç”¨** çš„æ‰§è¡Œæµç¨‹ï¼Œç‰¹åˆ«æ˜¯ `.then` å’Œ `.catch` çš„è°ƒç”¨é¡ºåºä»¥åŠè¿”å›å€¼çš„å½±å“ã€‚è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æå®ƒçš„æ‰§è¡Œè¿‡ç¨‹å’Œè¾“å‡ºç»“æœã€‚

---

## **ä»£ç æ‰§è¡Œæµç¨‹åˆ†æ**

### **1. `Promise.resolve(1)`**
```javascript
Promise.resolve(1)
```
- **`Promise.resolve(1)`** åˆ›å»ºä¸€ä¸ª **ç«‹å³ `fulfilled` çš„ Promise**ï¼Œå…¶å€¼ä¸º `1`ã€‚

---

### **2. ç¬¬ä¸€ä¸ª `.then`**
```javascript
.then(res => {
  console.log(res);  // è¾“å‡º 1
  return 2;          // è¿”å› 2ï¼Œä½¿ä¸‹ä¸€ä¸ª `.then` æ¥æ”¶ 2
})
```
- **`res` æ˜¯ `1`**ï¼ˆæ¥è‡ª `Promise.resolve(1)`ï¼‰ã€‚
- **è¾“å‡º `1`**ã€‚
- **è¿”å› `2`**ï¼Œè¿™ä¼šä½¿å¾—ä¸‹ä¸€ä¸ª `.then` æ¥æ”¶ `2`ã€‚

---

### **3. `.catch`ï¼ˆè¢«è·³è¿‡ï¼‰**
```javascript
.catch(err => {
  return 3;  // ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºå‰é¢çš„ `.then` æ²¡æœ‰æŠ›å‡ºé”™è¯¯
})
```
- **`.catch` ä¸ä¼šæ‰§è¡Œ**ï¼Œå› ä¸ºå‰é¢çš„ `.then` æ²¡æœ‰æŠ›å‡ºé”™è¯¯ã€‚
- å¦‚æœå‰é¢çš„ `.then` æŠ›å‡ºé”™è¯¯ï¼ˆå¦‚ `throw new Error()`ï¼‰ï¼Œ`.catch` æ‰ä¼šæ‰§è¡Œã€‚

---

### **4. ç¬¬äºŒä¸ª `.then`**
```javascript
.then(res => {
  console.log(res);  // è¾“å‡º 2ï¼ˆæ¥è‡ªç¬¬ä¸€ä¸ª `.then` çš„è¿”å›å€¼ï¼‰
})
```
- **`res` æ˜¯ `2`**ï¼ˆæ¥è‡ªç¬¬ä¸€ä¸ª `.then` çš„è¿”å›å€¼ï¼‰ã€‚
- **è¾“å‡º `2`**ã€‚

---

## **æœ€ç»ˆè¾“å‡º**
```
1
2
```

---

## **å…³é”®ç‚¹æ€»ç»“**
1. **`Promise.resolve(value)`**ï¼š
   - åˆ›å»ºä¸€ä¸ª **ç«‹å³ `fulfilled` çš„ Promise**ï¼Œå€¼ä¸º `value`ï¼ˆè¿™é‡Œæ˜¯ `1`ï¼‰ã€‚
2. **`.then` çš„æ‰§è¡Œé¡ºåº**ï¼š
   - å‰ä¸€ä¸ª `.then` çš„è¿”å›å€¼ä¼šä¼ é€’ç»™ä¸‹ä¸€ä¸ª `.then`ã€‚
   - å¦‚æœ `.then` è¿”å›æ™®é€šå€¼ï¼ˆå¦‚ `return 2`ï¼‰ï¼Œä¸‹ä¸€ä¸ª `.then` ä¼šæ¥æ”¶è¿™ä¸ªå€¼ã€‚
3. **`.catch` çš„æ‰§è¡Œæ¡ä»¶**ï¼š
   - åªæœ‰å½“ä¹‹å‰çš„ `.then` æŠ›å‡ºé”™è¯¯ï¼ˆ`throw`ï¼‰æˆ– Promise è¢« `reject` æ—¶ï¼Œ`.catch` æ‰ä¼šæ‰§è¡Œã€‚
   - åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ**`.catch` è¢«è·³è¿‡**ï¼Œå› ä¸ºå‰é¢çš„ `.then` æ²¡æœ‰é”™è¯¯ã€‚
4. **Promise é“¾å¼è°ƒç”¨çš„æ•°æ®æµ**ï¼š
   ```
   Promise.resolve(1) â†’ then(1) â†’ return 2 â†’ then(2)
   ```

---

## **æ‰©å±•æ€è€ƒ**
### **å¦‚æœç¬¬ä¸€ä¸ª `.then` æŠ›å‡ºé”™è¯¯ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ**
```javascript
Promise.resolve(1)
  .then(res => {
    console.log(res);  // è¾“å‡º 1
    throw new Error("Oops!");  // æŠ›å‡ºé”™è¯¯
  })
  .catch(err => {
    console.log("catch:", err.message);  // æ•è·é”™è¯¯
    return 3;  // è¿”å› 3ï¼Œä½¿ä¸‹ä¸€ä¸ª `.then` æ¥æ”¶ 3
  })
  .then(res => {
    console.log(res);  // è¾“å‡º 3
  });
```
**è¾“å‡º**ï¼š
```
1
catch: Oops!
3
```
- **`.catch` æ•è·é”™è¯¯åï¼Œå¯ä»¥è¿”å›æ–°å€¼**ï¼Œç»§ç»­é“¾å¼è°ƒç”¨ã€‚

---

### **å¦‚æœ `.catch` ä¹ŸæŠ›å‡ºé”™è¯¯ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ**
```javascript
Promise.resolve(1)
  .then(res => {
    console.log(res);
    throw new Error("First error");
  })
  .catch(err => {
    console.log("catch:", err.message);
    throw new Error("Second error");  // `.catch` ä¹ŸæŠ›å‡ºé”™è¯¯
  })
  .then(res => {
    console.log("then:", res);  // ä¸ä¼šæ‰§è¡Œ
  })
  .catch(err => {
    console.log("final catch:", err.message);  // æ•è·ç¬¬äºŒä¸ªé”™è¯¯
  });
```
**è¾“å‡º**ï¼š
```
1
catch: First error
final catch: Second error
```
- **é”™è¯¯ä¼šä¸€ç›´ä¼ é€’åˆ°æœ€åä¸€ä¸ª `.catch`**ã€‚

---

## **æ€»ç»“**
- **`Promise.resolve()`** åˆ›å»ºä¸€ä¸ª `fulfilled` çš„ Promiseã€‚
- **`.then`** ç”¨äºå¤„ç† `fulfilled` çŠ¶æ€ï¼Œè¿”å›å€¼ä¼šä¼ é€’ç»™ä¸‹ä¸€ä¸ª `.then`ã€‚
- **`.catch`** ç”¨äºå¤„ç† `rejected` çŠ¶æ€ï¼Œå¯ä»¥æ•è·å‰é¢çš„é”™è¯¯ã€‚
- **é”™è¯¯ä¼šæ²¿ç€ Promise é“¾ä¼ é€’**ï¼Œç›´åˆ°è¢« `.catch` æ•è·ã€‚
- **å¦‚æœ `.then` æˆ– `.catch` è¿”å›æ™®é€šå€¼**ï¼Œä¸‹ä¸€ä¸ª `.then` ä¼šæ¥æ”¶å®ƒã€‚

æŒæ¡è¿™äº›è§„åˆ™ï¼Œå°±èƒ½è½»æ¾åˆ†æ Promise çš„æ‰§è¡Œé¡ºåºï¼ ğŸš€


## EP11
```ts
Promise.reject(1)
  .then(res => {
    console.log(res);
    return 2;
  })
  .catch(err => {
    console.log(err);
    return 3
  })
  .then(res => {
    console.log(res);
  });
```

è¿™æ®µä»£ç å±•ç¤ºäº† **Promise çš„é”™è¯¯å¤„ç†æœºåˆ¶** å’Œ **é“¾å¼è°ƒç”¨çš„æ‰§è¡Œé¡ºåº**ã€‚è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æå®ƒçš„æ‰§è¡Œè¿‡ç¨‹å’Œè¾“å‡ºç»“æœã€‚

---

## **ä»£ç æ‰§è¡Œæµç¨‹åˆ†æ**

### **1. `Promise.reject(1)`**
```javascript
Promise.reject(1)
```
- **`Promise.reject(1)`** åˆ›å»ºä¸€ä¸ª **ç«‹å³ `rejected` çš„ Promise**ï¼Œå…¶å€¼ä¸º `1`ã€‚

---

### **2. ç¬¬ä¸€ä¸ª `.then`ï¼ˆè¢«è·³è¿‡ï¼‰**
```javascript
.then(res => {
  console.log(res);  // ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸º Promise æ˜¯ rejected
  return 2;
})
```
- **`.then` ä¸ä¼šæ‰§è¡Œ**ï¼Œå› ä¸º `Promise.reject(1)` çš„çŠ¶æ€æ˜¯ `rejected`ï¼Œ`.then` åªå¤„ç† `fulfilled` çŠ¶æ€ã€‚

---

### **3. `.catch`ï¼ˆæ•è·é”™è¯¯ï¼‰**
```javascript
.catch(err => {
  console.log(err);  // è¾“å‡º 1ï¼ˆæ¥è‡ª `Promise.reject(1)`ï¼‰
  return 3;          // è¿”å› 3ï¼Œä½¿ä¸‹ä¸€ä¸ª `.then` æ¥æ”¶ 3
})
```
- **`err` æ˜¯ `1`**ï¼ˆæ¥è‡ª `Promise.reject(1)`ï¼‰ã€‚
- **è¾“å‡º `1`**ã€‚
- **è¿”å› `3`**ï¼Œè¿™ä¼šä½¿å¾—ä¸‹ä¸€ä¸ª `.then` æ¥æ”¶ `3`ã€‚

---

### **4. ç¬¬äºŒä¸ª `.then`**
```javascript
.then(res => {
  console.log(res);  // è¾“å‡º 3ï¼ˆæ¥è‡ª `.catch` çš„è¿”å›å€¼ï¼‰
})
```
- **`res` æ˜¯ `3`**ï¼ˆæ¥è‡ª `.catch` çš„è¿”å›å€¼ï¼‰ã€‚
- **è¾“å‡º `3`**ã€‚

---

## **æœ€ç»ˆè¾“å‡º**
```
1
3
```

---

## **å…³é”®ç‚¹æ€»ç»“**
1. **`Promise.reject(value)`**ï¼š
   - åˆ›å»ºä¸€ä¸ª **ç«‹å³ `rejected` çš„ Promise**ï¼Œå€¼ä¸º `value`ï¼ˆè¿™é‡Œæ˜¯ `1`ï¼‰ã€‚
2. **`.then` çš„æ‰§è¡Œæ¡ä»¶**ï¼š
   - åªæœ‰å½“ Promise æ˜¯ `fulfilled` æ—¶ï¼Œ`.then` æ‰ä¼šæ‰§è¡Œã€‚
   - å¦‚æœ Promise æ˜¯ `rejected`ï¼Œ`.then` ä¼šè¢«è·³è¿‡ï¼Œç›´æ¥è¿›å…¥ `.catch`ã€‚
3. **`.catch` çš„æ‰§è¡Œæ¡ä»¶**ï¼š
   - å½“ Promise æ˜¯ `rejected` æˆ–å‰é¢çš„ `.then` æŠ›å‡ºé”™è¯¯æ—¶ï¼Œ`.catch` ä¼šæ‰§è¡Œã€‚
   - **`.catch` å¯ä»¥è¿”å›ä¸€ä¸ªæ–°å€¼**ï¼Œä½¿åç»­çš„ `.then` ç»§ç»­æ‰§è¡Œã€‚
4. **Promise é“¾å¼è°ƒç”¨çš„æ•°æ®æµ**ï¼š
   ```
   Promise.reject(1) â†’ catch(1) â†’ return 3 â†’ then(3)
   ```

---

## **æ‰©å±•æ€è€ƒ**
### **å¦‚æœ `.catch` ä¸è¿”å›ä»»ä½•å€¼ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ**
```javascript
Promise.reject(1)
  .catch(err => {
    console.log(err);  // è¾“å‡º 1
    // æ²¡æœ‰ returnï¼Œç›¸å½“äºè¿”å› undefined
  })
  .then(res => {
    console.log(res);  // è¾“å‡º undefined
  });
```
**è¾“å‡º**ï¼š
```
1
undefined
```
- **å¦‚æœ `.catch` ä¸è¿”å›ä»»ä½•å€¼**ï¼Œåç»­çš„ `.then` ä¼šæ¥æ”¶ `undefined`ã€‚

---

### **å¦‚æœ `.catch` æŠ›å‡ºé”™è¯¯ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ**
```javascript
Promise.reject(1)
  .catch(err => {
    console.log(err);  // è¾“å‡º 1
    throw new Error("Oops!");  // æŠ›å‡ºé”™è¯¯
  })
  .then(res => {
    console.log(res);  // ä¸ä¼šæ‰§è¡Œ
  })
  .catch(err => {
    console.log(err.message);  // è¾“å‡º "Oops!"
  });
```
**è¾“å‡º**ï¼š
```
1
Oops!
```
- **`.catch` æŠ›å‡ºé”™è¯¯å**ï¼Œåç»­çš„ `.then` ä¼šè¢«è·³è¿‡ï¼Œé”™è¯¯ä¼šè¢«ä¸‹ä¸€ä¸ª `.catch` æ•è·ã€‚

---

## **æ€»ç»“**
- **`Promise.reject()`** åˆ›å»ºä¸€ä¸ª `rejected` çš„ Promiseã€‚
- **`.then` åªå¤„ç† `fulfilled` çŠ¶æ€**ï¼Œå¦‚æœ Promise æ˜¯ `rejected`ï¼Œ`.then` ä¼šè¢«è·³è¿‡ã€‚
- **`.catch` å¤„ç† `rejected` çŠ¶æ€**ï¼Œå¯ä»¥æ•è·é”™è¯¯å¹¶è¿”å›æ–°å€¼ï¼Œä½¿åç»­çš„ `.then` ç»§ç»­æ‰§è¡Œã€‚
- **é”™è¯¯ä¼šæ²¿ç€ Promise é“¾ä¼ é€’**ï¼Œç›´åˆ°è¢« `.catch` æ•è·ã€‚

æŒæ¡è¿™äº›è§„åˆ™ï¼Œå°±èƒ½è½»æ¾åˆ†æ Promise çš„æ‰§è¡Œé¡ºåºï¼ ğŸš€
