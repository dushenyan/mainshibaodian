# 判断数组的方式有哪些？

## 可用环境代码

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>数组类型判断方法</title>
</head>
<body>
  <script>
    // 这里将放置我们的示例代码
    const testCases = [
      [1, 2, 3],          // 纯数组
      new Array(5),       // 通过Array构造函数创建的数组
      { length: 0 },      // 类数组对象
      "string",           // 字符串
      123,                // 数字
      true,               // 布尔值
      null,               // null
      undefined,          // undefined
      function() {},      // 函数
      document.body.childNodes // DOM集合（类数组）
    ];
  </script>
</body>
</html>
```

## 回答

面试官您好，我来详细介绍一下 JavaScript 中判断数组的几种方法，以及它们各自的优缺点。

### 1. 使用 `Array.isArray()` (ES5+ 推荐方式)

这是目前最可靠、最推荐的判断数组的方法：

```javascript
console.log(Array.isArray([1, 2, 3])); // true
console.log(Array.isArray({})); // false
console.log(Array.isArray("123")); // false
```

**优点**：
- 专门为判断数组设计
- 跨iframe/跨窗口安全
- 代码简洁直观

**缺点**：
- ES5+ 支持，IE8及以下不支持（但现代开发基本无需考虑）

### 2. 使用 `instanceof` 操作符

```javascript
console.log([1, 2, 3] instanceof Array); // true
console.log({} instanceof Array); // false
```

**优点**：
- 语法简单
- 早期浏览器支持

**缺点**：
- 在跨窗口/iframe场景下不可靠
- 可能被原型链修改影响

### 3. 使用 `Object.prototype.toString.call()`

```javascript
console.log(Object.prototype.toString.call([1, 2, 3]) === '[object Array]'); // true
console.log(Object.prototype.toString.call({}) === '[object Array]'); // false
```

**优点**：
- 最可靠的类型判断方法
- 适用于所有JavaScript值
- 跨iframe/窗口安全

**缺点**：
- 语法稍显冗长
- 需要记住特定的字符串格式

### 4. 检查 `constructor` 属性

```javascript
console.log([1, 2, 3].constructor === Array); // true
console.log({}.constructor === Array); // false
```

**优点**：
- 语法简单

**缺点**：
- 可以被修改，不可靠
- 跨iframe/窗口不安全
- 在null/undefined上会报错

### 5. 检查数组特有方法

```javascript
function isArray(obj) {
  return obj && typeof obj === 'object' && typeof obj.push === 'function';
}
console.log(isArray([1, 2, 3])); // true
console.log(isArray({ push: function() {} })); // 误判
```

**优点**：
- 可以检测类数组对象

**缺点**：
- 容易误判
- 不可靠

### 6. 使用 `Array.prototype.isPrototypeOf()`

```javascript
console.log(Array.prototype.isPrototypeOf([1, 2, 3])); // true
console.log(Array.prototype.isPrototypeOf({})); // false
```

**优点**：
- 原型链检查

**缺点**：
- 跨iframe/窗口不安全
- 语法不够直观

## 完整测试示例

```javascript
function testAllMethods(value) {
  return {
    value: value,
    'Array.isArray': Array.isArray(value),
    'instanceof Array': value instanceof Array,
    'toString.call': Object.prototype.toString.call(value) === '[object Array]',
    'constructor': value && value.constructor === Array,
    'isPrototypeOf': Array.prototype.isPrototypeOf(value)
  };
}

const results = testCases.map(testAllMethods);
console.table(results);
```

## 特殊情况处理

### 类数组对象判断

```javascript
function isArrayLike(obj) {
  if (!obj || typeof obj !== 'object') return false;
  
  // 检查length属性
  const length = obj.length;
  if (typeof length !== 'number' || length < 0) return false;
  
  // 额外检查是否是DOM集合
  if (typeof obj.item === 'function') return true;
  
  // 普通类数组检查
  return length === 0 || 
    (length > 0 && (length - 1) in obj);
}

console.log(isArrayLike([1, 2, 3])); // true
console.log(isArrayLike(document.body.childNodes)); // true
console.log(isArrayLike({ length: 3, 0: 'a', 1: 'b', 2: 'c' })); // true
console.log(isArrayLike({ length: 0 })); // true
console.log(isArrayLike('string')); // false
```

## 通俗易懂的总结

可以把数组判断方法比作不同类型的"身份验证"：

1. **`Array.isArray()`** - 就像最先进的身份证识别器，专门设计用来识别数组，又快又准
2. **`instanceof`** - 像传统的门禁卡，在自家公司(窗口)好用，但去分公司(iframe)可能失效
3. **`toString.call()`** - 像DNA检测，最准确但过程复杂，能识别任何"生物"(数据类型)
4. **`constructor`检查** - 像工作证，可以伪造，不太可靠
5. **方法检查** - 像通过行为猜测身份，容易认错人

**最佳实践建议**：
- 现代开发无脑用 `Array.isArray()`
- 需要兼容IE8等老浏览器时用 `toString.call()`
- 判断类数组对象需要额外检查length等属性

## 最终推荐方案

```javascript
// 最可靠的数组检测函数（兼容性考虑）
function isArray(obj) {
  if (typeof Array.isArray === 'function') {
    return Array.isArray(obj);
  }
  return Object.prototype.toString.call(obj) === '[object Array]';
}

// 类数组对象检测
function isArrayLike(obj) {
  if (obj == null || typeof obj !== 'object') return false;
  const length = obj.length;
  return typeof length === 'number' && 
    length >= 0 && 
    (length === 0 || (length > 0 && (length - 1) in obj));
}
```
